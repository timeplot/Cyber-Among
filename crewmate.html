<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crewmate Cyber Security Game</title>
    <style>
        /* Matrix Cyber Theme - Crewmate Variant */
        :root {
            --matrix-green: #00ff41;
            --matrix-dark: #0a0a0a;
            --matrix-darker: #000;
            --matrix-glow: #00ff41;
            --success: #00ff88;
            --warning: #ffaa00;
            --danger: #ff0040;
            --crewmate-blue: #3d85c6;
            --crewmate-red: #c63d3d;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #001a00 0%, #000 100%);
            color: var(--matrix-green);
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }

        /* Matrix Background */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.1;
        }

        .digit {
            position: absolute;
            color: var(--matrix-green);
            font-size: 14px;
            text-shadow: 0 0 5px var(--matrix-glow);
            animation: fall linear infinite;
        }

        @keyframes fall {
            to { transform: translateY(100vh); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(0, 20, 0, 0.9);
            border: 2px solid var(--matrix-green);
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 65, 0.1), transparent);
            animation: scan 3s linear infinite;
        }

        @keyframes scan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .header h1 {
            color: var(--matrix-green);
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 0 0 15px var(--matrix-glow);
        }

        .subtitle {
            color: #88ff88;
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .game-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            font-size: 1.1em;
            color: #88ff88;
        }

        .timer-display {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--matrix-green);
            text-shadow: 0 0 10px var(--matrix-glow);
        }

        .emergency-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid #ff0040;
            border-radius: 10px;
            color: #ff0040;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .emergency-btn:hover {
            background: rgba(255, 0, 0, 0.3);
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
        }

        .task-container {
            background: rgba(0, 20, 0, 0.9);
            border: 2px solid var(--matrix-green);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.2);
        }

        .task-navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .nav-btn {
            padding: 15px 30px;
            background: rgba(0, 255, 65, 0.1);
            border: 2px solid var(--matrix-green);
            border-radius: 10px;
            color: var(--matrix-green);
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: rgba(0, 255, 65, 0.2);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.3);
        }

        .nav-btn.active {
            background: rgba(0, 255, 65, 0.3);
            border-color: var(--success);
        }

        .nav-btn.completed {
            background: rgba(0, 255, 136, 0.2);
            border-color: var(--success);
        }

        .task-content {
            min-height: 500px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--matrix-green);
            border-radius: 10px;
            padding: 30px;
        }

        .task-page {
            display: none;
        }

        .task-page.active {
            display: block;
        }

        h2 {
            color: var(--matrix-green);
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--matrix-glow);
            text-align: center;
            font-size: 2em;
        }

        /* Task 1: Network Security Log */
        .log-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--matrix-green);
            border-radius: 8px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
        }

        .log-entry {
            background: rgba(0, 255, 65, 0.05);
            border: 1px solid var(--matrix-green);
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .log-entry.suspicious {
            border-color: var(--warning);
            background: rgba(255, 170, 0, 0.1);
        }

        .log-entry.marked {
            border-color: var(--success);
            background: rgba(0, 255, 136, 0.1);
        }

        .log-info {
            flex: 1;
            display: grid;
            grid-template-columns: 100px 100px 120px 100px 140px 140px auto;
            gap: 10px;
            font-size: 0.9em;
        }

        .log-time {
            color: #88ff88;
            font-weight: bold;
        }

        .log-host {
            color: #88ff88;
        }

        .log-service {
            color: #88ff88;
        }

        .log-action {
            font-weight: bold;
        }

        .log-source, .log-dest {
            font-family: monospace;
        }

        .log-details {
            color: #88ff88;
            font-style: italic;
        }

        .mark-btn {
            padding: 8px 16px;
            background: rgba(0, 255, 65, 0.1);
            border: 1px solid var(--matrix-green);
            border-radius: 5px;
            color: var(--matrix-green);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .mark-btn:hover {
            background: rgba(0, 255, 65, 0.2);
        }

        .mark-btn.marked {
            background: rgba(0, 255, 136, 0.2);
            border-color: var(--success);
        }

        /* Task 2: Phishing Email */
        .email-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            height: 400px;
        }

        .email-column {
            border: 2px solid var(--matrix-green);
            border-radius: 8px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
        }

        .email-column h3 {
            text-align: center;
            margin-bottom: 15px;
            color: var(--matrix-green);
        }

        .email-list {
            height: 320px;
            overflow-y: auto;
            padding: 10px;
        }

        .email-item {
            background: rgba(0, 255, 65, 0.05);
            border: 1px solid var(--matrix-green);
            border-radius: 5px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: grab;
            transition: all 0.3s ease;
        }

        .email-item:hover {
            background: rgba(0, 255, 65, 0.1);
        }

        .email-item.dragging {
            opacity: 0.5;
        }

        /* Task 3: Firewall Construction */
        .firewall-container {
            text-align: center;
        }

        .code-blocks {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .code-block {
            background: rgba(0, 255, 65, 0.05);
            border: 2px solid var(--matrix-green);
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
            text-align: left;
        }

        .code-block:hover {
            background: rgba(0, 255, 65, 0.1);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.2);
        }

        .code-block.selected {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--success);
        }

        .code-block.danger {
            border-color: var(--danger);
            background: rgba(255, 0, 64, 0.05);
        }

        .code-block.danger.selected {
            background: rgba(255, 0, 64, 0.1);
        }

        .progress-section {
            margin-top: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: rgba(0, 255, 65, 0.1);
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--matrix-green), #00ff88);
            border-radius: 15px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .task-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .control-btn {
            padding: 15px 30px;
            background: rgba(0, 255, 65, 0.1);
            border: 2px solid var(--matrix-green);
            border-radius: 10px;
            color: var(--matrix-green);
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover:not(:disabled) {
            background: rgba(0, 255, 65, 0.2);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.3);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .control-btn.complete {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--success);
        }

        /* Sabotage Effects */
        .sabotage-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 0, 0, 0.1);
            z-index: 999;
            pointer-events: none;
        }

        .sabotage-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 0, 0, 0.9);
            color: white;
            padding: 30px 50px;
            border-radius: 15px;
            font-size: 2em;
            font-weight: bold;
            text-align: center;
        }

        /* Status Messages */
        .status-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 20, 0, 0.95);
            border: 3px solid;
            border-radius: 15px;
            padding: 30px 50px;
            font-size: 1.5em;
            font-weight: bold;
            z-index: 1000;
            text-align: center;
        }

        .status-success {
            border-color: var(--success);
            color: var(--success);
        }

        .status-warning {
            border-color: var(--warning);
            color: var(--warning);
        }

        .status-error {
            border-color: var(--danger);
            color: var(--danger);
        }

        /* Voting Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 20, 0, 0.95);
            border: 2px solid var(--matrix-green);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 50px rgba(0, 255, 65, 0.5);
            min-width: 600px;
            max-width: 90vw;
        }

        .voting-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        .vote-option {
            padding: 15px;
            background: rgba(0, 255, 65, 0.05);
            border: 1px solid var(--matrix-green);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .vote-option:hover {
            background: rgba(0, 255, 65, 0.1);
        }

        .vote-option.selected {
            background: rgba(0, 255, 65, 0.2);
            border-color: var(--success);
        }

        .player-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid var(--matrix-green);
        }

        /* Task Instructions */
        .task-instructions {
            text-align: center;
            margin-bottom: 20px;
            color: #88ff88;
            font-size: 1.1em;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .task-navigation {
                flex-direction: column;
                align-items: center;
            }
            
            .email-container {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .log-info {
                grid-template-columns: 1fr;
                gap: 5px;
            }
            
            .code-blocks {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                min-width: 90vw;
                padding: 20px;
            }
            
            .voting-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Matrix Background -->
    <div class="matrix-bg" id="matrixBg"></div>

    <!-- Emergency Meeting Button -->
    <button class="emergency-btn" onclick="callEmergencyMeeting()">🚨 EMERGENCY MEETING</button>

    <!-- Sabotage Overlay -->
    <div id="sabotageOverlay" class="sabotage-overlay">
        <div class="sabotage-message" id="sabotageMessage"></div>
    </div>

    <!-- Voting Modal -->
    <div id="votingModal" class="modal">
        <div class="modal-content">
            <h2>🚨 EMERGENCY MEETING</h2>
            <div style="text-align: center; margin-bottom: 20px; color: #88ff88;">
                Discuss and vote for who you think is the Impostor
            </div>
            <div class="voting-options" id="votingOptions"></div>
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                <button class="control-btn" onclick="submitVote()">SUBMIT VOTE</button>
                <button class="control-btn skip-vote" onclick="skipVote()">SKIP VOTE</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>👨‍🚀 CREWMATE PANEL</h1>
            <div class="subtitle">Complete all 3 tasks to secure the system</div>
            <div class="game-info">
                <span id="aliveCount">7 Crewmates alive</span>
                <span id="tasksProgress">Tasks: 0/3 Completed</span>
                <span class="timer-display" id="gameTimer">05:00</span>
            </div>
        </div>

        <div class="task-container">
            <!-- Task Navigation -->
            <div class="task-navigation">
                <button class="nav-btn active" onclick="showTask(1)">🔍 TASK 1: SECURITY LOG</button>
                <button class="nav-btn" onclick="showTask(2)">📧 TASK 2: PHISHING FILTER</button>
                <button class="nav-btn" onclick="showTask(3)">🛡️ TASK 3: FIREWALL BUILD</button>
            </div>

            <!-- Task Content -->
            <div class="task-content">
                <!-- Task 1: Network Security Log -->
                <div class="task-page active" id="task1">
                    <h2>🔍 NETWORK SECURITY LOG ANALYSIS</h2>
                    <div class="task-instructions">
                        Identify and mark suspicious log entries. There are 5 suspicious entries hidden in the logs.
                    </div>
                    
                    <div class="log-container" id="logContainer">
                        <!-- Log entries will be generated here -->
                    </div>

                    <div class="task-controls">
                        <button class="control-btn" onclick="resetTask1()">RESET SELECTION</button>
                        <button class="control-btn complete" onclick="completeTask1()" id="completeTask1" disabled>COMPLETE TASK 1</button>
                    </div>
                </div>

                <!-- Task 2: Phishing Email Filter -->
                <div class="task-page" id="task2">
                    <h2>📧 PHISHING EMAIL FILTER</h2>
                    <div class="task-instructions">
                        Drag emails to the Phishing column. Be careful - some emails are legitimate!
                    </div>
                    
                    <div class="email-container">
                        <div class="email-column" id="inboxColumn">
                            <h3>📥 INBOX</h3>
                            <div class="email-list" id="inboxList">
                                <!-- Emails will be populated here -->
                            </div>
                        </div>
                        <div class="email-column" id="phishingColumn">
                            <h3>🚫 PHISHING</h3>
                            <div class="email-list" id="phishingList">
                                <!-- Phishing emails will be dragged here -->
                            </div>
                        </div>
                    </div>

                    <div class="task-controls">
                        <button class="control-btn" onclick="resetTask2()">RESET EMAILS</button>
                        <button class="control-btn complete" onclick="completeTask2()" id="completeTask2" disabled>COMPLETE TASK 2</button>
                    </div>
                </div>

                <!-- Task 3: Firewall Construction -->
                <div class="task-page" id="task3">
                    <h2>🛡️ FIREWALL CONSTRUCTION</h2>
                    <div class="task-instructions">
                        Select only the SAFE code blocks to build your firewall. Avoid malware code!
                    </div>
                    
                    <div class="firewall-container">
                        <div class="code-blocks" id="codeBlocks">
                            <!-- Code blocks will be generated here -->
                        </div>

                        <div class="progress-section">
                            <div class="progress-bar">
                                <div class="progress-fill" id="firewallProgress" style="width: 0%"></div>
                            </div>
                            <div style="color: #88ff88;">Firewall Integrity: <span id="integrityPercent">0%</span></div>
                        </div>
                    </div>

                    <div class="task-controls">
                        <button class="control-btn" onclick="resetTask3()">RESET SELECTION</button>
                        <button class="control-btn complete" onclick="completeTask3()" id="completeTask3" disabled>COMPLETE TASK 3</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game state variables
        let currentTaskPage = 1;
        let tasksCompleted = 0;
        let selectedVote = null;

        // ========== TASK 1: NETWORK SECURITY LOG ==========
        let suspiciousEntries = [19, 21, 22, 26, 47];
        let selectedEntries = [];

        // Log data from main.html
        const logData = [
        ];

        // ========== TASK 2: PHISHING EMAIL ==========
        let draggedEmail = null;
        const emails = [ { id: 1, timestamp: "Oct 09 00:15:03", host: "websrv01", service: "kernel", action: "ACCEPT", source: "192.168.1.42", dest: "192.168.1.10", protocol: "TCP", srcPort: "53214", destPort: "443", details: "" },
  { id: 2, timestamp: "Oct 09 00:17:22", host: "fw01", service: "kernel", action: "ACCEPT", source: "192.168.1.10", dest: "8.8.8.8", protocol: "UDP", srcPort: "51723", destPort: "53", details: "" },
  { id: 3, timestamp: "Oct 09 00:18:15", host: "dbsrv02", service: "sshd", action: "Accepted password", source: "192.168.1.50", dest: "", protocol: "SSH", srcPort: "51512", destPort: "22", details: "for admin" },
  { id: 4, timestamp: "Oct 09 00:19:41", host: "app01", service: "systemd", action: "Started", source: "", dest: "", protocol: "", srcPort: "", destPort: "", details: "nginx service" },
  { id: 5, timestamp: "Oct 09 00:20:09", host: "websrv02", service: "httpd", action: "GET", source: "192.168.1.50", dest: "", protocol: "HTTP", srcPort: "", destPort: "80", details: "/index.html 200 1423" },
  { id: 6, timestamp: "Oct 09 00:21:55", host: "fw01", service: "kernel", action: "ACCEPT", source: "192.168.1.33", dest: "93.184.216.34", protocol: "TCP", srcPort: "54021", destPort: "80", details: "" },
  { id: 7, timestamp: "Oct 09 00:25:16", host: "mail01", service: "postfix/smtpd", action: "connect", source: "192.168.1.15", dest: "", protocol: "SMTP", srcPort: "", destPort: "25", details: "" },
  { id: 8, timestamp: "Oct 09 00:28:12", host: "mail01", service: "postfix/smtpd", action: "disconnect", source: "192.168.1.15", dest: "", protocol: "SMTP", srcPort: "", destPort: "25", details: "ehlo=1 mail=1 rcpt=1" },
  { id: 9, timestamp: "Oct 09 00:30:42", host: "fw01", service: "kernel", action: "ACCEPT", source: "192.168.1.60", dest: "172.217.10.14", protocol: "TCP", srcPort: "50344", destPort: "443", details: "" },
  { id: 10, timestamp: "Oct 09 00:33:09", host: "websrv01", service: "httpd", action: "GET", source: "192.168.1.45", dest: "", protocol: "HTTP", srcPort: "", destPort: "80", details: "/api/v1/status 200 312" },
  { id: 11, timestamp: "Oct 09 00:35:02", host: "dbsrv01", service: "CRON", action: "CMD", source: "", dest: "", protocol: "", srcPort: "", destPort: "", details: "/usr/local/bin/backup.sh" },
  { id: 12, timestamp: "Oct 09 00:36:48", host: "fw01", service: "kernel", action: "ACCEPT", source: "192.168.1.41", dest: "192.168.1.10", protocol: "TCP", srcPort: "53311", destPort: "22", details: "" },
  { id: 13, timestamp: "Oct 09 00:37:11", host: "fw01", service: "kernel", action: "DROP", source: "203.0.113.21", dest: "192.168.1.10", protocol: "TCP", srcPort: "54321", destPort: "22", details: "" },
  { id: 14, timestamp: "Oct 09 00:39:09", host: "app01", service: "nginx", action: "GET", source: "", dest: "", protocol: "HTTP", srcPort: "", destPort: "80", details: "/login 200 1056" },
  { id: 15, timestamp: "Oct 09 01:02:11", host: "fw01", service: "kernel", action: "DROP", source: "45.83.212.99", dest: "192.168.1.10", protocol: "TCP", srcPort: "50412", destPort: "22", details: "multiple attempts" },
  { id: 16, timestamp: "Oct 09 01:04:43", host: "websrv02", service: "sshd", action: "Failed password", source: "45.83.212.99", dest: "", protocol: "SSH", srcPort: "50412", destPort: "22", details: "for invalid user test" },
  { id: 17, timestamp: "Oct 09 01:05:01", host: "websrv02", service: "sshd", action: "Failed password", source: "45.83.212.99", dest: "", protocol: "SSH", srcPort: "50413", destPort: "22", details: "for invalid user admin" },
  { id: 18, timestamp: "Oct 09 01:05:44", host: "websrv02", service: "sshd", action: "Failed password", source: "45.83.212.99", dest: "", protocol: "SSH", srcPort: "50414", destPort: "22", details: "for invalid user root" },
  { id: 19, timestamp: "Oct 09 01:06:09", host: "websrv02", service: "sshd", action: "Accepted password", source: "45.83.212.99", dest: "Unkown", protocol: "SSH", srcPort: "50415", destPort: "22", details: "for admin" },
  { id: 20, timestamp: "Oct 09 01:07:42", host: "fw01", service: "kernel", action: "ACCEPT", source: "192.168.1.10", dest: "198.51.100.44", protocol: "TCP", srcPort: "49831", destPort: "8080", details: "unusual outbound" },
  { id: 21, timestamp: "Oct 09 01:09:12", host: "app01", service: "systemd", action: "Unexpected process", source: "", dest: "Unkown", protocol: "", srcPort: "", destPort: "", details: "/tmp/.hidden/runme.sh" },
  { id: 22, timestamp: "Oct 09 01:09:33", host: "fw01", service: "kernel", action: "ACCEPT", source: "192.168.1.10", dest: "Unkown", protocol: "TCP", srcPort: "49832", destPort: "8080", details: "data exfil pattern" },
  { id: 23, timestamp: "Oct 09 01:10:41", host: "dbsrv02", service: "systemd", action: "Created user", source: "", dest: "", protocol: "", srcPort: "", destPort: "", details: "backup1" },
  { id: 24, timestamp: "Oct 09 01:12:56", host: "fw01", service: "kernel", action: "DROP", source: "203.0.113.44", dest: "192.168.1.10", protocol: "TCP", srcPort: "50522", destPort: "3389", details: "" },
  { id: 25, timestamp: "Oct 09 01:15:32", host: "websrv02", service: "httpd", action: "POST", source: "192.168.1.10", dest: "", protocol: "HTTP", srcPort: "", destPort: "80", details: "/upload.php 500 0" },
  { id: 26, timestamp: "Oct 09 01:16:04", host: "fw01", service: "kernel", action: "ACCEPT", source: "192.168.1.10", dest: "Unkown", protocol: "TCP", srcPort: "49833", destPort: "8080", details: "persistence beacon" },
  { id: 27, timestamp: "Oct 09 01:17:49", host: "app01", service: "CRON", action: "CMD", source: "", dest: "", protocol: "", srcPort: "", destPort: "", details: "/tmp/.hidden/runme.sh" },
  { id: 28, timestamp: "Oct 09 01:20:10", host: "fw01", service: "kernel", action: "ACCEPT", source: "192.168.1.45", dest: "192.168.1.10", protocol: "TCP", srcPort: "54111", destPort: "443", details: "" },
  { id: 29, timestamp: "Oct 09 01:23:39", host: "dbsrv01", service: "systemd", action: "Finished", source: "", dest: "", protocol: "", srcPort: "", destPort: "", details: "hourly data sync" },
  { id: 30, timestamp: "Oct 09 01:26:11", host: "websrv01", service: "httpd", action: "GET", source: "", dest: "", protocol: "HTTP", srcPort: "", destPort: "80", details: "/api/v1/health 200 421" },
  { id: 31, timestamp: "Oct 09 01:29:52", host: "app01", service: "systemd", action: "Completed", source: "", dest: "", protocol: "", srcPort: "", destPort: "", details: "scheduled cleanup" },
  { id: 32, timestamp: "Oct 09 01:31:10", host: "fw01", service: "kernel", action: "ACCEPT", source: "192.168.1.12", dest: "172.217.10.14", protocol: "TCP", srcPort: "50513", destPort: "443", details: "" },
  { id: 33, timestamp: "Oct 09 01:34:20", host: "fw01", service: "kernel", action: "DROP", source: "10.0.0.250", dest: "192.168.1.10", protocol: "ICMP", srcPort: "", destPort: "", details: "TYPE=8 CODE=0" },
  { id: 34, timestamp: "Oct 09 01:36:51", host: "websrv02", service: "httpd", action: "GET", source: "", dest: "", protocol: "HTTP", srcPort: "", destPort: "80", details: "/reports 200 2031" },
  { id: 35, timestamp: "Oct 09 01:40:13", host: "mail01", service: "postfix/smtpd", action: "connect", source: "192.168.1.15", dest: "", protocol: "SMTP", srcPort: "", destPort: "25", details: "" },
  { id: 36, timestamp: "Oct 09 01:42:59", host: "mail01", service: "postfix/smtpd", action: "disconnect", source: "192.168.1.15", dest: "", protocol: "SMTP", srcPort: "", destPort: "25", details: "" },
  { id: 37, timestamp: "Oct 09 01:45:33", host: "fw01", service: "kernel", action: "ACCEPT", source: "192.168.1.45", dest: "172.217.14.110", protocol: "TCP", srcPort: "50222", destPort: "443", details: "" },
  { id: 38, timestamp: "Oct 09 02:00:01", host: "websrv02", service: "httpd", action: "GET", source: "192.168.1.50", dest: "", protocol: "HTTP", srcPort: "", destPort: "80", details: "/home.html 200 1582" },
  { id: 39, timestamp: "Oct 09 02:01:22", host: "fw01", service: "kernel", action: "ACCEPT", source: "192.168.1.20", dest: "192.168.1.10", protocol: "TCP", srcPort: "52022", destPort: "443", details: "" },
  { id: 40, timestamp: "Oct 09 02:03:41", host: "dbsrv02", service: "systemd", action: "Started", source: "", dest: "", protocol: "", srcPort: "", destPort: "", details: "nightly backup" },
  { id: 41, timestamp: "Oct 09 02:05:12", host: "app01", service: "nginx", action: "GET", source: "", dest: "", protocol: "HTTP", srcPort: "", destPort: "80", details: "/dashboard 200 1203" },
  { id: 42, timestamp: "Oct 09 02:07:44", host: "websrv01", service: "httpd", action: "GET", source: "192.168.1.55", dest: "", protocol: "HTTP", srcPort: "", destPort: "80", details: "/api/v2/status 200 342" },
  { id: 43, timestamp: "Oct 09 02:09:55", host: "fw01", service: "kernel", action: "DROP", source: "203.0.113.21", dest: "192.168.1.10", protocol: "TCP", srcPort: "54322", destPort: "22", details: "" },
  { id: 44, timestamp: "Oct 09 02:11:22", host: "app01", service: "CRON", action: "CMD", source: "", dest: "", protocol: "", srcPort: "", destPort: "", details: "/usr/local/bin/cleanup.sh" },
  { id: 45, timestamp: "Oct 09 02:13:33", host: "websrv02", service: "sshd", action: "Failed password", source: "203.0.113.21", dest: "", protocol: "SSH", srcPort: "50422", destPort: "22", details: "for invalid user guest" },
  { id: 46, timestamp: "Oct 09 02:15:11", host: "dbsrv01", service: "systemd", action: "Created", source: "", dest: "", protocol: "", srcPort: "", destPort: "", details: "temporary log archive" },
  { id: 47, timestamp: "Oct 09 02:16:47", host: "fw01", service: "kernel", action: "ACCEPT", source: "192.168.1.10", dest: "Unkown", protocol: "TCP", srcPort: "49834", destPort: "8080", details: "unusual outbound" },
  { id: 48, timestamp: "Oct 09 02:18:21", host: "app01", service: "systemd", action: "Unexpected process", source: "", dest: "", protocol: "", srcPort: "", destPort: "", details: "/tmp/.hidden/script.sh" },
  { id: 49, timestamp: "Oct 09 02:20:44", host: "mail01", service: "postfix/smtpd", action: "connect", source: "192.168.1.16", dest: "", protocol: "SMTP", srcPort: "", destPort: "25", details: "" },
  { id: 50, timestamp: "Oct 09 02:22:59", host: "websrv02", service: "httpd", action: "GET", source: "", dest: "", protocol: "HTTP", srcPort: "", destPort: "80", details: "/login 200 1043" },
  { id: 51, timestamp: "Oct 09 02:24:12", host: "fw01", service: "kernel", action: "DROP", source: "203.0.113.44", dest: "192.168.1.10", protocol: "TCP", srcPort: "50523", destPort: "3389", details: "" },
  { id: 52, timestamp: "Oct 09 02:26:30", host: "dbsrv02", service: "sshd", action: "Accepted password", source: "192.168.1.50", dest: "", protocol: "SSH", srcPort: "51520", destPort: "22", details: "for admin" },
  { id: 53, timestamp: "Oct 09 02:28:11", host: "app01", service: "nginx", action: "POST", source: "", dest: "", protocol: "HTTP", srcPort: "", destPort: "80", details: "/upload.php 500 0" },
  { id: 54, timestamp: "Oct 09 02:29:59", host: "websrv01", service: "httpd", action: "GET", source: "192.168.1.45", dest: "", protocol: "HTTP", srcPort: "", destPort: "80", details: "/api/v1/stats 200 218" },
  { id: 55, timestamp: "Oct 09 02:31:40", host: "fw01", service: "kernel", action: "ACCEPT", source: "192.168.1.10", dest: "198.51.100.44", protocol: "TCP", srcPort: "49835", destPort: "8080", details: "persistence beacon" },
  { id: 56, timestamp: "Oct 09 02:33:11", host: "app01", service: "CRON", action: "CMD", source: "", dest: "", protocol: "", srcPort: "", destPort: "", details: "/tmp/.hidden/runme.sh" },
  { id: 57, timestamp: "Oct 09 02:34:52", host: "websrv02", service: "httpd", action: "GET", source: "", dest: "", protocol: "HTTP", srcPort: "", destPort: "80", details: "/reports 200 2041" },
  { id: 58, timestamp: "Oct 09 02:36:31", host: "mail01", service: "postfix/smtpd", action: "disconnect", source: "192.168.1.16", dest: "", protocol: "SMTP", srcPort: "", destPort: "25", details: "" },
  { id: 59, timestamp: "Oct 09 02:38:10", host: "fw01", service: "kernel", action: "ACCEPT", source: "192.168.1.45", dest: "172.217.14.111", protocol: "TCP", srcPort: "50223", destPort: "443", details: "" },
  { id: 60, timestamp: "Oct 09 02:40:55", host: "dbsrv01", service: "systemd", action: "Completed", source: "", dest: "", protocol: "", srcPort: "", destPort: "", details: "hourly data sync" },
  { id: 61, timestamp: "Oct 09 02:42:31", host: "websrv01", service: "httpd", action: "GET", source: "", dest: "", protocol: "HTTP", srcPort: "", destPort: "80", details: "/api/v2/health 200 422" },
  { id: 62, timestamp: "Oct 09 02:44:17", host: "fw01", service: "kernel", action: "DROP", source: "10.0.0.251", dest: "192.168.1.10", protocol: "ICMP", srcPort: "", destPort: "", details: "TYPE=8 CODE=0" },
  { id: 63, timestamp: "Oct 09 02:45:33", host: "app01", service: "systemd", action: "Completed", source: "", dest: "", protocol: "", srcPort: "", destPort: "", details: "scheduled maintenance" },
  { id: 64, timestamp: "Oct 09 02:46:12", host: "mail01", service: "postfix/smtpd", action: "connect", source: "192.168.1.17", dest: "", protocol: "SMTP", srcPort: "", destPort: "25", details: "" },
  { id: 65, timestamp: "Oct 09 02:47:59", host: "websrv02", service: "httpd", action: "GET", source: "", dest: "", protocol: "HTTP", srcPort: "", destPort: "80", details: "/dashboard 200 1211" },
  { id: 66, timestamp: "Oct 09 02:49:30", host: "fw01", service: "kernel", action: "ACCEPT", source: "192.168.1.46", dest: "172.217.14.112", protocol: "TCP", srcPort: "50224", destPort: "443", details: "" },
  { id: 67, timestamp: "Oct 09 02:50:47", host: "dbsrv02", service: "systemd", action: "Finished", source: "", dest: "", protocol: "", srcPort: "", destPort: "", details: "temporary backup" }
        ];

        // ========== TASK 3: FIREWALL CONSTRUCTION ==========
        let selectedBlocks = [];
        const codeBlocksData = [
            { text: 'firewall --enable-protection --level=high', safe: true },
            { text: 'scan --system --full --report', safe: true },
            { text: 'rm -rf /system/* --force', safe: false },
            { text: 'open --port=4444 --protocol=tcp', safe: false },
            { text: 'update --definitions --auto', safe: true },
            { text: 'encrypt --all-users --key="malicious"', safe: false },
            { text: 'block --ip=192.168.1.100 --permanent', safe: true },
            { text: 'install --package=trojan.exe --silent', safe: false },
            { text: 'log --analyze --suspicious', safe: true },
            { text: 'execute --script="format_c_drive.bat"', safe: false },
            { text: 'quarantine --file="suspicious.dll"', safe: true },
            { text: 'disable --antivirus --temporary', safe: false }
        ];

        // Create Matrix background
        function createMatrixEffect() {
            const container = document.getElementById('matrixBg');
            const digits = '0101010101';
            const count = 50;
            
            for (let i = 0; i < count; i++) {
                const digit = document.createElement('div');
                digit.className = 'digit';
                digit.textContent = digits[Math.floor(Math.random() * digits.length)];
                digit.style.left = Math.random() * 100 + 'vw';
                digit.style.animationDuration = (2 + Math.random() * 4) + 's';
                digit.style.animationDelay = Math.random() * 3 + 's';
                digit.style.opacity = Math.random() * 0.3 + 0.1;
                container.appendChild(digit);
            }
        }

        // Navigation
        function showTask(taskNumber) {
            // Hide all tasks
            document.querySelectorAll('.task-page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected task
            document.getElementById(`task${taskNumber}`).classList.add('active');
            document.querySelectorAll('.nav-btn')[taskNumber - 1].classList.add('active');
            
            currentTaskPage = taskNumber;
        }

        // ========== TASK 1 FUNCTIONS ==========
        function initializeTask1() {
            const logContainer = document.getElementById('logContainer');
            
            logContainer.innerHTML = logData.map(entry => {
                const isSuspicious = suspiciousEntries.includes(entry.id);
                const isSelected = selectedEntries.includes(entry.id);
                return `
                    <div class="log-entry ${isSuspicious ? 'suspicious' : ''} ${isSelected ? 'marked' : ''}" data-id="${entry.id}">
                        <div class="log-info">
                            <span class="log-time">${entry.timestamp}</span>
                            <span class="log-host">${entry.host}</span>
                            <span class="log-service">${entry.service}</span>
                            <span class="log-action">${entry.action}</span>
                            <span class="log-source">${entry.source}</span>
                            <span class="log-dest">${entry.dest}</span>
                            <span class="log-details">${entry.details}</span>
                        </div>
                        <button class="mark-btn ${isSelected ? 'marked' : ''}" onclick="markLogEntry(${entry.id})">
                            ${isSelected ? '✅ SELECTED' : 'SELECT'}
                        </button>
                    </div>
                `;
            }).join('');
            
            checkTask1Completion();
        }

        function markLogEntry(id) {
            const index = selectedEntries.indexOf(id);
            if (index === -1) {
                selectedEntries.push(id);
            } else {
                selectedEntries.splice(index, 1);
            }
            initializeTask1(); // Re-render to update visuals
            checkTask1Completion();
        }

        function checkTask1Completion() {
            const allSuspiciousSelected = suspiciousEntries.every(id => selectedEntries.includes(id));
            const noIncorrectSelected = selectedEntries.every(id => suspiciousEntries.includes(id));
            document.getElementById('completeTask1').disabled = !(allSuspiciousSelected && noIncorrectSelected);
        }

        function resetTask1() {
            selectedEntries = [];
            initializeTask1();
            document.getElementById('completeTask1').disabled = true;
        }

        function completeTask1() {
            tasksCompleted++;
            updateTasksProgress();
            showStatusMessage('🎉 Task 1 Completed! Suspicious activities identified.', 'success');
            document.querySelectorAll('.nav-btn')[0].classList.add('completed');
        }

        // ========== TASK 2 FUNCTIONS ==========
        function initializeTask2() {
            const inboxList = document.getElementById('inboxList');
            const phishingList = document.getElementById('phishingList');
            
            // Clear lists
            inboxList.innerHTML = '';
            phishingList.innerHTML = '';
            
            // Shuffle and add emails to inbox
            const shuffledEmails = [...emails].sort(() => Math.random() - 0.5);
            
            shuffledEmails.forEach(email => {
                const emailElement = document.createElement('div');
                emailElement.className = 'email-item';
                emailElement.draggable = true;
                emailElement.dataset.id = email.id;
                emailElement.dataset.type = email.type;
                emailElement.textContent = email.text;
                emailElement.ondragstart = dragEmail;
                
                inboxList.appendChild(emailElement);
            });
            
            setupDropZones();
            checkTask2Completion();
        }

        function dragEmail(event) {
            draggedEmail = event.target;
            event.target.classList.add('dragging');
        }

        function setupDropZones() {
            const phishingColumn = document.getElementById('phishingList');
            const inboxColumn = document.getElementById('inboxList');
            
            [phishingColumn, inboxColumn].forEach(column => {
                column.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });

                column.addEventListener('drop', (e) => {
                    e.preventDefault();
                    if (draggedEmail) {
                        column.appendChild(draggedEmail);
                        draggedEmail.classList.remove('dragging');
                        checkTask2Completion();
                    }
                });
            });
        }

        function checkTask2Completion() {
            const phishingList = document.getElementById('phishingList');
            const emailsInPhishing = Array.from(phishingList.querySelectorAll('.email-item'));
            
            // Check if all phishing emails are in phishing column and no real emails are there
            const allPhishingCorrect = emailsInPhishing.every(email => 
                email.dataset.type === 'phishing'
            );
            
            const allPhishingPresent = emails.filter(e => e.type === 'phishing')
                .every(phishingEmail => 
                    emailsInPhishing.some(email => parseInt(email.dataset.id) === phishingEmail.id)
                );

            document.getElementById('completeTask2').disabled = !(allPhishingCorrect && allPhishingPresent);
        }

        function resetTask2() {
            initializeTask2();
            document.getElementById('completeTask2').disabled = true;
        }

        function completeTask2() {
            tasksCompleted++;
            updateTasksProgress();
            showStatusMessage('🎉 Task 2 Completed! Phishing emails filtered.', 'success');
            document.querySelectorAll('.nav-btn')[1].classList.add('completed');
        }

        // ========== TASK 3 FUNCTIONS ==========
        function initializeTask3() {
            const codeBlocksContainer = document.getElementById('codeBlocks');
            
            codeBlocksContainer.innerHTML = codeBlocksData.map((block, index) => {
                const isSelected = selectedBlocks.includes(index);
                return `
                    <div class="code-block ${block.safe ? '' : 'danger'} ${isSelected ? 'selected' : ''}" 
                         onclick="selectFirewallBlock(${index})" 
                         data-index="${index}">
                        <code>${block.text}</code>
                    </div>
                `;
            }).join('');

            updateFirewallProgress();
        }

        function selectFirewallBlock(index) {
            const block = document.querySelector(`.code-block[data-index="${index}"]`);
            
            if (selectedBlocks.includes(index)) {
                selectedBlocks = selectedBlocks.filter(i => i !== index);
                block.classList.remove('selected');
            } else {
                selectedBlocks.push(index);
                block.classList.add('selected');
            }

            updateFirewallProgress();
        }

        function updateFirewallProgress() {
            const safeBlocks = selectedBlocks.filter(index => codeBlocksData[index].safe);
            const unsafeBlocks = selectedBlocks.filter(index => !codeBlocksData[index].safe);
            
            let integrity = 0;
            if (selectedBlocks.length > 0) {
                // Positive points for safe blocks, negative for unsafe
                integrity = Math.max(0, (safeBlocks.length * 2 - unsafeBlocks.length * 3) / (codeBlocksData.length * 2) * 100);
            }
            
            document.getElementById('firewallProgress').style.width = `${integrity}%`;
            document.getElementById('integrityPercent').textContent = `${Math.round(integrity)}%`;
            
            document.getElementById('completeTask3').disabled = integrity < 80;
        }

        function resetTask3() {
            selectedBlocks = [];
            initializeTask3();
        }

        function completeTask3() {
            tasksCompleted++;
            updateTasksProgress();
            showStatusMessage('🎉 Task 3 Completed! Firewall operational.', 'success');
            document.querySelectorAll('.nav-btn')[2].classList.add('completed');
        }

        // ========== GAME FUNCTIONS ==========
        function updateTasksProgress() {
            document.getElementById('tasksProgress').textContent = `Tasks: ${tasksCompleted}/3 Completed`;
            
            if (tasksCompleted === 3) {
                showStatusMessage('🎉 ALL TASKS COMPLETED! CREWMATES WIN!', 'success');
            }
        }

        function updateGameTimer(minutes, seconds) {
            document.getElementById('gameTimer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function showStatusMessage(message, type) {
            const status = document.createElement('div');
            status.className = `status-message status-${type}`;
            status.textContent = message;
            document.body.appendChild(status);
            
            setTimeout(() => status.remove(), 3000);
        }

        // Emergency Meeting
        function callEmergencyMeeting() {
            showStatusMessage('🚨 Emergency Meeting Called!', 'warning');
            // In a real implementation, this would trigger a socket event
        }

        // Voting functions
        function showVotingModal(votingPlayers) {
            const modal = document.getElementById('votingModal');
            const options = document.getElementById('votingOptions');
            
            options.innerHTML = votingPlayers.map(player => `
                <div class="vote-option" onclick="selectVote('${player.id}')">
                    <span class="player-color" style="background-color: ${player.color}"></span>
                    ${player.name}
                </div>
            `).join('');
            
            modal.style.display = 'block';
            selectedVote = null;
        }

        function selectVote(playerId) {
            document.querySelectorAll('.vote-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[onclick="selectVote('${playerId}')"]`).classList.add('selected');
            selectedVote = playerId;
        }

        function submitVote() {
            if (selectedVote) {
                // In a real implementation, this would trigger a socket event
                console.log(`Voted for: ${selectedVote}`);
            } else {
                console.log('Skipped vote');
            }
            document.getElementById('votingModal').style.display = 'none';
        }

        function skipVote() {
            // In a real implementation, this would trigger a socket event
            console.log('Skipped vote');
            document.getElementById('votingModal').style.display = 'none';
        }

        // Sabotage effects
        function showSabotageEffect(type) {
            const overlay = document.getElementById('sabotageOverlay');
            const message = document.getElementById('sabotageMessage');
            
            const effects = {
                shuffle: { message: '🔄 TASKS SHUFFLED!', duration: 3000 },
                freeze: { message: '❄️ UI FROZEN!', duration: 5000 },
                malware: { message: '💉 MALWARE INJECTED!', duration: 4000 }
            };
            
            const effect = effects[type];
            if (effect) {
                message.textContent = effect.message;
                overlay.style.display = 'block';
                
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, effect.duration);
            }
        }

        // Initialize all tasks
        function initializeTasks() {
            initializeTask1();
            initializeTask2();
            initializeTask3();
            updateTasksProgress();
            
            // Set up a mock timer
            let timeLeft = 5 * 60; // 5 minutes
            setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                updateGameTimer(minutes, seconds);
                
                if (timeLeft <= 0) {
                    showStatusMessage('⏰ Time\'s up! Impostors win!', 'error');
                }
            }, 1000);
        }

        // Initialize the game
        createMatrixEffect();
        initializeTasks();

        // Add CSS animation for pulse
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { opacity: 1; }
                50% { opacity: 0.5; }
                100% { opacity: 1; }
            }
            .skip-vote {
                background: rgba(255, 170, 0, 0.1) !important;
                border-color: var(--warning) !important;
                color: var(--warning) !important;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>